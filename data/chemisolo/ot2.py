from typing import Tuple, List
from opentrons import protocol_api
from opentrons.types import Location
import time
import json
import csv

# metadata
metadata = {
    "protocolName": "Colony Picker into 384 Well Plate",
    "author": "Colin Rathbun <rathbunc@dickinson.edu>",
    "description": "Given a CSV of colony locations, pick the colonies and innoculate them in a 384 well plate.",
    "apiLevel": "2.12",
}

TESTING = False  # This should be False when not testing

# Other hardcoded parameters
NUMBER_OF_WELL_PLATES = 3
NUMBER_OF_WELLS = 96 # only 96 wells per plate for now
AGAR_PLATE_TYPE = "square dish" # This can be "square dish" only for now
FRZ_WELL = "A2"
PBS_WELL = "A1"
CONTROL_WELLS = ["A1", "B1", "C1", "D1", "E1", "F1"]  # Don't forget to pick these!

colonies_picked = len(CONTROL_WELLS)

# Paste CSV files here. This can only be between 1 and 4 dishes. There MUST be enogh colonies in the csv to fill all well plates.
if TESTING:
    PLATE_CSV = """
x coord,y coord,quality,x mm,y mm,x%,y%,image_name,plate
469,95,0.9999999999999996,11.855787781350482,23.5540192926045,0.19987840818259264,0.5735789429588336,ansi_colony_test_1.png,1
278,25,0.96875,-15.443086816720259,33.5588424437299,-0.26035719154885373,0.8172127710636772,ansi_colony_test_1.png,1
749,257,0.9583333333333329,51.875080385852094,0.4,0.8745693397260743,0.009740655059052722,ansi_colony_test_1.png,1
616,306,0.9375,32.86591639871383,-6.603376205787781,0.5540911472429205,-0.1608030246143378,ansi_colony_test_1.png,1
536,146,0.9375,21.431832797427653,16.264790996784566,0.3613223096590686,0.39607429676816186,ansi_colony_test_1.png,1
284,353,0.9375,-14.585530546623795,-13.320900321543409,-0.24589952873006485,-0.3243857377704471,ansi_colony_test_1.png,1
207,311,0.9375,-25.590836012861736,-7.318006430868167,-0.43143953490452225,-0.17820544090754092,ansi_colony_test_1.png,1
648,252,0.9250000000000005,37.4395498392283,1.114630225080386,0.6311986822764613,0.027143071352255837,ansi_colony_test_1.png,1
207,505,0.9166666666666663,-25.590836012861736,-35.04565916398714,-0.43143953490452225,-0.8534191930838217,ansi_colony_test_1.png,1
228,50,0.90625,-22.589389067524113,29.985691318327973,-0.38083771503876107,0.7302006895976616,ansi_colony_test_1.png,1
529,116,0.875,20.431350482315114,20.55257234726688,0.3444550363704816,0.5004887945273806,ansi_colony_test_1.png,1
467,217,0.875,11.569935691318328,6.117041800643087,0.19505918724299634,0.14895998540467764,ansi_colony_test_1.png,1
282,324,0.875,-14.87138263665595,-9.17604501607717,-0.2507187496696611,-0.223451723269869,ansi_colony_test_1.png,1
579,309,0.84375,27.577652733118974,-7.032154340836013,0.46493555986038904,-0.17124447439025967,ansi_colony_test_1.png,1
319,71,0.84375,-9.583118971061094,26.984244372990354,-0.16156316228712964,0.6571105411662086,ansi_colony_test_1.png,1
299,37,0.84375,-12.441639871382637,31.84372990353698,-0.2097553716830926,0.7754469719599898,ansi_colony_test_1.png,1
73,412,0.833333333333333,-44.74292604501608,-21.75353697749196,-0.7543273378574742,-0.5297342500302439,ansi_colony_test_1.png,1
733,216,0.8125,49.58826366559486,6.2599678456591645,0.8360155722093039,0.15244046866331828,ansi_colony_test_1.png,1
710,307,0.8125,46.30096463022508,-6.746302250803859,0.7805945314039464,-0.16428350787297843,ansi_colony_test_1.png,1
561,392,0.8125,25.004983922829584,-18.89501607717042,0.42156257140402237,-0.46012458485743146,ansi_colony_test_1.png,1
509,30,0.8125,17.57282958199357,32.84421221864952,0.2962628269745186,0.7998103547704741,ansi_colony_test_1.png,1
504,298,0.8125,16.858199356913186,-5.459967845659164,0.2842147746255279,-0.1329591585452128,ansi_colony_test_1.png,1
317,337,0.8125,-9.868971061093248,-11.034083601286174,-0.16638238322672594,-0.2686980056321971,ansi_colony_test_1.png,1
317,119,0.8125,-9.868971061093248,20.123794212218648,-0.16638238322672594,0.49004734475145867,ansi_colony_test_1.png,1
226,312,0.8125,-22.875241157556268,-7.460932475884245,-0.3856569359783574,-0.18168592416618154,ansi_colony_test_1.png,1
74,201,0.7916666666666664,-44.6,8.403858520900322,-0.751917727387676,0.2046477175429276,ansi_colony_test_1.png,1
664,194,0.78125,39.726366559485534,9.404340836012862,0.6697524497932317,0.22901110035341196,ansi_colony_test_1.png,1
266,175,0.78125,-17.158199356913183,12.119935691318329,-0.2892725171864315,0.2951402822675838,ansi_colony_test_1.png,1
692,259,0.75,43.728295819935695,0.11414790996784568,0.7372215429475798,0.002779688541771477,ansi_colony_test_1.png,1
520,363,0.75,19.14501607717042,-14.75016077170418,0.3227685421422983,-0.3591905703568533,ansi_colony_test_1.png,1
380,262,0.75,-0.8646302250803859,-0.31463022508038585,-0.014576923629442568,-0.007661761234150392,ansi_colony_test_1.png,1
309,349,0.75,-11.012379421221866,-12.7491961414791,-0.18565926698511112,-0.3104638047358846,ansi_colony_test_1.png,1
152,212,0.75,-33.45176848874598,6.831672025723473,-0.5639681107434203,0.16636240169788077,ansi_colony_test_1.png,1
415,404,0.7499999999999998,4.137781350482315,-20.610128617363348,0.06975944281349263,-0.501890383961119,ansi_colony_test_1.png,1
256,24,0.7499999999999998,-18.587459807073955,33.70176848874598,-0.313368621884413,0.8206932543223178,ansi_colony_test_1.png,1
555,44,0.71875,24.14742765273312,30.843247588424436,0.40710490858523346,0.7510835891495053,ansi_colony_test_1.png,1
547,160,0.71875,23.004019292604504,14.263826366559487,0.38782802482684825,0.3473475311471932,ansi_colony_test_1.png,1
542,127,0.71875,22.289389067524116,18.98038585209003,0.3757799724778575,0.46220347868233363,ansi_colony_test_1.png,1
419,202,0.71875,4.709485530546623,8.260932475884244,0.07939788469268522,0.20116723428428698,ansi_colony_test_1.png,1
450,233,0.7083333333333331,9.140192926045016,3.830225080385852,0.15409580925642782,0.09327225326642767,ansi_colony_test_1.png,1
653,231,0.7000000000000003,38.15418006430868,4.116077170418007,0.643246734625452,0.10023321978370892,ansi_colony_test_1.png,1
620,173,0.7000000000000003,33.43762057877814,12.405787781350483,0.5637295891221131,0.30210124878486505,ansi_colony_test_1.png,1
530,201,0.6875,20.574276527331193,8.403858520900322,0.34686464684027973,0.2046477175429276,ansi_colony_test_1.png,1
311,479,0.6875,-10.726527331189711,-31.329581993569136,-0.18084004604551482,-0.7629266283591657,ansi_colony_test_1.png,1
76,243,0.6875,-44.31414790996784,2.40096463022508,-0.7470985064480796,0.05846742068002144,ansi_colony_test_1.png,1
458,3,0.6666666666666665,10.283601286173633,36.7032154340836,0.173372693014813,0.893783402753771,ansi_colony_test_1.png,1
423,132,0.65625,5.281189710610932,18.265755627009646,0.08903632657187781,0.4448010623891306,ansi_colony_test_1.png,1
351,201,0.65625,-5.009485530546624,8.403858520900322,-0.08445562725358888,0.2046477175429276,ansi_colony_test_1.png,1
389,44,0.625,0.42170418006430865,30.843247588424436,0.007109570598740768,0.7510835891495053,ansi_colony_test_1.png,1
489,193,0.6249999999999999,14.714308681672026,9.54726688102894,0.2480706175785556,0.2324915836120526,ansi_colony_test_1.png,1
265,392,0.6249999999999999,-17.30112540192926,-18.89501607717042,-0.2916821276562296,-0.46012458485743146,ansi_colony_test_1.png,1
262,448,0.6249999999999999,-17.729903536977492,-26.89887459807074,-0.2989109590656241,-0.6550316473413063,ansi_colony_test_1.png,1
581,276,0.59375,27.86350482315113,-2.3155948553054664,0.46975478079998534,-0.056388526855119116,ansi_colony_test_1.png,1
338,172,0.59375,-6.867524115755628,12.54871382636656,-0.11578056336096482,0.3055817320435057,ansi_colony_test_1.png,1
124,3,0.5833333333333333,-37.45369774919614,36.7032154340836,-0.6314372038977685,0.893783402753771,ansi_colony_test_1.png,1
14,456,0.5625,-53.17556270096463,-28.04228295819936,-0.896494355575565,-0.6828755134104313,ansi_colony_test_1.png,1
386,172,0.5416666666666666,-0.0070739549839228255,12.54871382636656,-0.00011926081065367657,0.3055817320435057,ansi_colony_test_1.png,1
81,216,0.5416666666666666,-43.59951768488746,6.2599678456591645,-0.735050454099089,0.15244046866331828,ansi_colony_test_1.png,1
488,193,1.0,14.57138263665595,9.54726688102894,0.2456610071087575,0.2324915836120526,n8_plate_1.png,2
449,233,0.9999999999999996,8.997266881028938,3.830225080385852,0.15168619878662967,0.09327225326642767,n8_plate_1.png,2
265,392,0.9999999999999996,-17.30112540192926,-18.89501607717042,-0.2916821276562296,-0.46012458485743146,n8_plate_1.png,2
580,276,0.9750000000000005,27.72057877813505,-2.3155948553054664,0.46734517033018713,-0.056388526855119116,n8_plate_1.png,2
7,69,0.96875,-54.17604501607717,27.270096463022508,-0.913361628864152,0.6640715076834898,n8_plate_1.png,2
261,448,0.9583333333333329,-17.872829581993567,-26.89887459807074,-0.3013205695354222,-0.6550316473413063,n8_plate_1.png,2
418,470,0.9375,4.566559485530546,-30.04324758842444,0.07698827422288707,-0.7316022790314,n8_plate_1.png,2
337,171,0.9375,-7.010450160771705,12.691639871382637,-0.11819017383076297,0.30906221530214634,n8_plate_1.png,2
81,216,0.9375,-43.59951768488746,6.2599678456591645,-0.735050454099089,0.15244046866331828,n8_plate_1.png,2
680,134,0.90625,42.01318327974277,17.979903536977492,0.708306217310002,0.43784009587184936,n8_plate_1.png,2
423,132,0.90625,5.281189710610932,18.265755627009646,0.08903632657187781,0.4448010623891306,n8_plate_1.png,2
380,274,0.90625,-0.8646302250803859,-2.029742765273312,-0.014576923629442568,-0.04942756033783787,n8_plate_1.png,2
505,200,0.875,17.00112540192926,8.546784565916399,0.286624385095326,0.20812820080156821,n8_plate_1.png,2
415,404,0.875,4.137781350482315,-20.610128617363348,0.06975944281349263,-0.501890383961119,n8_plate_1.png,2
103,188,0.875,-40.455144694533764,10.261897106109325,-0.6820390237635298,0.2498939999052557,n8_plate_1.png,2
76,243,0.875,-44.31414790996784,2.40096463022508,-0.7470985064480796,0.05846742068002144,n8_plate_1.png,2
546,160,0.84375,22.861093247588425,14.263826366559487,0.3854184143570501,0.3473475311471932,n8_plate_1.png,2
457,21,0.84375,10.140675241157556,34.13054662379421,0.17096308254501486,0.8311347040982396,n8_plate_1.png,2
350,201,0.84375,-5.152411575562701,8.403858520900322,-0.08686523772338703,0.2046477175429276,n8_plate_1.png,2
291,179,0.84375,-13.585048231511255,11.54823151125402,-0.2290322554414778,0.2812183492330213,n8_plate_1.png,2
255,24,0.833333333333333,-18.73038585209003,33.70176848874598,-0.3157782323542111,0.8206932543223178,n8_plate_1.png,2
277,25,0.8250000000000004,-15.586012861736336,33.5588424437299,-0.2627668020186519,0.8172127710636772,n8_plate_1.png,2
542,127,0.8125,22.289389067524116,18.98038585209003,0.3757799724778575,0.46220347868233363,n8_plate_1.png,2
390,23,0.8125,0.5646302250803859,33.84469453376206,0.009519181068538917,0.8241737375809585,n8_plate_1.png,2
386,173,0.8125,-0.0070739549839228255,12.405787781350483,-0.00011926081065367657,0.30210124878486505,n8_plate_1.png,2
318,71,0.8125,-9.72604501607717,26.984244372990354,-0.1639727727569278,0.6571105411662086,n8_plate_1.png,2
312,479,0.8125,-10.583601286173634,-31.329581993569136,-0.17843043557571667,-0.7629266283591657,n8_plate_1.png,2
225,312,0.8125,-23.018167202572346,-7.460932475884245,-0.3880665464481556,-0.18168592416618154,n8_plate_1.png,2
73,306,0.8125,-44.74292604501608,-6.603376205787781,-0.7543273378574742,-0.1608030246143378,n8_plate_1.png,2
579,308,0.8000000000000004,27.577652733118974,-6.889228295819936,0.46493555986038904,-0.16776399113161905,n8_plate_1.png,2
508,30,0.8000000000000004,17.429903536977495,32.84421221864952,0.29385321650472046,0.7998103547704741,n8_plate_1.png,2
460,137,0.7916666666666664,10.569453376205788,17.55112540192926,0.1781919139544093,0.4273986460959274,n8_plate_1.png,2
672,184,0.78125,40.86977491961415,10.833601286173634,0.6890293335516169,0.2638159329398182,n8_plate_1.png,2
541,36,0.78125,22.14646302250804,31.986655948553054,0.37337036200805934,0.7789274552186304,n8_plate_1.png,2
709,307,0.7750000000000004,46.158038585209006,-6.746302250803859,0.7781849209341484,-0.16428350787297843,n8_plate_1.png,2
653,231,0.7500000000000003,38.15418006430868,4.116077170418007,0.643246734625452,0.10023321978370892,n8_plate_1.png,2
419,201,0.7500000000000003,4.709485530546623,8.403858520900322,0.07939788469268522,0.2046477175429276,n8_plate_1.png,2
748,256,0.75,51.73215434083602,0.5429260450160772,0.8721597292562762,0.013221138317693346,n8_plate_1.png,2
554,43,0.75,24.004501607717042,30.986173633440515,0.40469529811543525,0.754564072408146,n8_plate_1.png,2
528,116,0.75,20.28842443729904,20.55257234726688,0.3420454259006835,0.5004887945273806,n8_plate_1.png,2
469,95,0.75,11.855787781350482,23.5540192926045,0.19987840818259264,0.5735789429588336,n8_plate_1.png,2
308,349,0.75,-11.155305466237943,-12.7491961414791,-0.18806887745490927,-0.3104638047358846,n8_plate_1.png,2
91,152,0.7499999999999998,-42.17025723472669,15.407234726688104,-0.7109543494011075,0.37519139721631817,n8_plate_1.png,2
620,173,0.7291666666666669,33.43762057877814,12.405787781350483,0.5637295891221131,0.30210124878486505,n8_plate_1.png,2
530,201,0.7250000000000003,20.574276527331193,8.403858520900322,0.34686464684027973,0.2046477175429276,n8_plate_1.png,2
152,212,0.7250000000000003,-33.45176848874598,6.831672025723473,-0.5639681107434203,0.16636240169788077,n8_plate_1.png,2
672,323,0.71875,40.86977491961415,-9.033118971061093,0.6890293335516169,-0.2199712400112284,n8_plate_1.png,2
663,194,0.71875,39.58344051446946,9.404340836012862,0.6673428393234335,0.22901110035341196,n8_plate_1.png,2
379,262,0.71875,-1.007556270096463,-0.31463022508038585,-0.016986534099240717,-0.007661761234150392,n8_plate_1.png,2
324,88,0.71875,-8.868488745980708,24.55450160771704,-0.14951510993813888,0.5979423257693179,n8_plate_1.png,2
41,141,0.71875,-49.31655948553055,16.97942122186495,-0.8314348728910149,0.4134767130613649,n8_plate_1.png,2
616,305,0.7000000000000003,32.86591639871383,-6.460450160771704,0.5540911472429205,-0.15732254135569718,n8_plate_1.png,2
504,297,0.7000000000000003,16.858199356913186,-5.317041800643087,0.2842147746255279,-0.1294786752865722,n8_plate_1.png,2
692,258,0.6875,43.728295819935695,0.2570739549839228,0.7372215429475798,0.006260171800412099,n8_plate_1.png,2
283,353,0.6875,-14.728456591639873,-13.320900321543409,-0.248309139199863,-0.3243857377704471,n8_plate_1.png,2
225,63,0.6875,-23.018167202572346,28.12765273311897,-0.3880665464481556,0.6849544072353335,n8_plate_1.png,2
23,46,0.6875,-51.88922829581993,30.55739549839228,-0.8748078613473815,0.7441226226322242,n8_plate_1.png,2
74,200,0.6666666666666665,-44.6,8.546784565916399,-0.751917727387676,0.20812820080156821,n8_plate_1.png,2
732,215,0.65625,49.44533762057878,6.402893890675242,0.8336059617395057,0.1559209519219589,n8_plate_1.png,2
473,283,0.65625,12.427491961414791,-3.3160771704180068,0.20951685006178525,-0.08075190966560349,n8_plate_1.png,2
445,25,0.65625,8.42556270096463,33.5588424437299,0.14204775690743707,0.8172127710636772,n8_plate_1.png,2
282,323,0.65625,-14.87138263665595,-9.033118971061093,-0.2507187496696611,-0.2199712400112284,n8_plate_1.png,2
14,455,0.65625,-53.17556270096463,-27.899356913183283,-0.896494355575565,-0.6793950301517907,n8_plate_1.png,2
469,95,0.9999999999999996,11.855787781350482,23.5540192926045,0.19987840818259264,0.5735789429588336,ansi_colony_test_1.png,1
278,25,0.96875,-15.443086816720259,33.5588424437299,-0.26035719154885373,0.8172127710636772,ansi_colony_test_1.png,1
749,257,0.9583333333333329,51.875080385852094,0.4,0.8745693397260743,0.009740655059052722,ansi_colony_test_1.png,1
616,306,0.9375,32.86591639871383,-6.603376205787781,0.5540911472429205,-0.1608030246143378,ansi_colony_test_1.png,1
536,146,0.9375,21.431832797427653,16.264790996784566,0.3613223096590686,0.39607429676816186,ansi_colony_test_1.png,1
284,353,0.9375,-14.585530546623795,-13.320900321543409,-0.24589952873006485,-0.3243857377704471,ansi_colony_test_1.png,1
207,311,0.9375,-25.590836012861736,-7.318006430868167,-0.43143953490452225,-0.17820544090754092,ansi_colony_test_1.png,1
648,252,0.9250000000000005,37.4395498392283,1.114630225080386,0.6311986822764613,0.027143071352255837,ansi_colony_test_1.png,1
207,505,0.9166666666666663,-25.590836012861736,-35.04565916398714,-0.43143953490452225,-0.8534191930838217,ansi_colony_test_1.png,1
228,50,0.90625,-22.589389067524113,29.985691318327973,-0.38083771503876107,0.7302006895976616,ansi_colony_test_1.png,1
529,116,0.875,20.431350482315114,20.55257234726688,0.3444550363704816,0.5004887945273806,ansi_colony_test_1.png,1
467,217,0.875,11.569935691318328,6.117041800643087,0.19505918724299634,0.14895998540467764,ansi_colony_test_1.png,1
282,324,0.875,-14.87138263665595,-9.17604501607717,-0.2507187496696611,-0.223451723269869,ansi_colony_test_1.png,1
579,309,0.84375,27.577652733118974,-7.032154340836013,0.46493555986038904,-0.17124447439025967,ansi_colony_test_1.png,1
319,71,0.84375,-9.583118971061094,26.984244372990354,-0.16156316228712964,0.6571105411662086,ansi_colony_test_1.png,1
299,37,0.84375,-12.441639871382637,31.84372990353698,-0.2097553716830926,0.7754469719599898,ansi_colony_test_1.png,1
73,412,0.833333333333333,-44.74292604501608,-21.75353697749196,-0.7543273378574742,-0.5297342500302439,ansi_colony_test_1.png,1
733,216,0.8125,49.58826366559486,6.2599678456591645,0.8360155722093039,0.15244046866331828,ansi_colony_test_1.png,1
710,307,0.8125,46.30096463022508,-6.746302250803859,0.7805945314039464,-0.16428350787297843,ansi_colony_test_1.png,1
561,392,0.8125,25.004983922829584,-18.89501607717042,0.42156257140402237,-0.46012458485743146,ansi_colony_test_1.png,1
509,30,0.8125,17.57282958199357,32.84421221864952,0.2962628269745186,0.7998103547704741,ansi_colony_test_1.png,1
504,298,0.8125,16.858199356913186,-5.459967845659164,0.2842147746255279,-0.1329591585452128,ansi_colony_test_1.png,1
317,337,0.8125,-9.868971061093248,-11.034083601286174,-0.16638238322672594,-0.2686980056321971,ansi_colony_test_1.png,1
317,119,0.8125,-9.868971061093248,20.123794212218648,-0.16638238322672594,0.49004734475145867,ansi_colony_test_1.png,1
226,312,0.8125,-22.875241157556268,-7.460932475884245,-0.3856569359783574,-0.18168592416618154,ansi_colony_test_1.png,1
74,201,0.7916666666666664,-44.6,8.403858520900322,-0.751917727387676,0.2046477175429276,ansi_colony_test_1.png,1
664,194,0.78125,39.726366559485534,9.404340836012862,0.6697524497932317,0.22901110035341196,ansi_colony_test_1.png,1
266,175,0.78125,-17.158199356913183,12.119935691318329,-0.2892725171864315,0.2951402822675838,ansi_colony_test_1.png,1
692,259,0.75,43.728295819935695,0.11414790996784568,0.7372215429475798,0.002779688541771477,ansi_colony_test_1.png,1
520,363,0.75,19.14501607717042,-14.75016077170418,0.3227685421422983,-0.3591905703568533,ansi_colony_test_1.png,1
380,262,0.75,-0.8646302250803859,-0.31463022508038585,-0.014576923629442568,-0.007661761234150392,ansi_colony_test_1.png,1
309,349,0.75,-11.012379421221866,-12.7491961414791,-0.18565926698511112,-0.3104638047358846,ansi_colony_test_1.png,1
152,212,0.75,-33.45176848874598,6.831672025723473,-0.5639681107434203,0.16636240169788077,ansi_colony_test_1.png,1
415,404,0.7499999999999998,4.137781350482315,-20.610128617363348,0.06975944281349263,-0.501890383961119,ansi_colony_test_1.png,1
256,24,0.7499999999999998,-18.587459807073955,33.70176848874598,-0.313368621884413,0.8206932543223178,ansi_colony_test_1.png,1
555,44,0.71875,24.14742765273312,30.843247588424436,0.40710490858523346,0.7510835891495053,ansi_colony_test_1.png,1
547,160,0.71875,23.004019292604504,14.263826366559487,0.38782802482684825,0.3473475311471932,ansi_colony_test_1.png,1
542,127,0.71875,22.289389067524116,18.98038585209003,0.3757799724778575,0.46220347868233363,ansi_colony_test_1.png,1
419,202,0.71875,4.709485530546623,8.260932475884244,0.07939788469268522,0.20116723428428698,ansi_colony_test_1.png,1
450,233,0.7083333333333331,9.140192926045016,3.830225080385852,0.15409580925642782,0.09327225326642767,ansi_colony_test_1.png,1
653,231,0.7000000000000003,38.15418006430868,4.116077170418007,0.643246734625452,0.10023321978370892,ansi_colony_test_1.png,1
620,173,0.7000000000000003,33.43762057877814,12.405787781350483,0.5637295891221131,0.30210124878486505,ansi_colony_test_1.png,1
530,201,0.6875,20.574276527331193,8.403858520900322,0.34686464684027973,0.2046477175429276,ansi_colony_test_1.png,1
311,479,0.6875,-10.726527331189711,-31.329581993569136,-0.18084004604551482,-0.7629266283591657,ansi_colony_test_1.png,1
76,243,0.6875,-44.31414790996784,2.40096463022508,-0.7470985064480796,0.05846742068002144,ansi_colony_test_1.png,1
458,3,0.6666666666666665,10.283601286173633,36.7032154340836,0.173372693014813,0.893783402753771,ansi_colony_test_1.png,1
423,132,0.65625,5.281189710610932,18.265755627009646,0.08903632657187781,0.4448010623891306,ansi_colony_test_1.png,1
351,201,0.65625,-5.009485530546624,8.403858520900322,-0.08445562725358888,0.2046477175429276,ansi_colony_test_1.png,1
389,44,0.625,0.42170418006430865,30.843247588424436,0.007109570598740768,0.7510835891495053,ansi_colony_test_1.png,1
489,193,0.6249999999999999,14.714308681672026,9.54726688102894,0.2480706175785556,0.2324915836120526,ansi_colony_test_1.png,1
265,392,0.6249999999999999,-17.30112540192926,-18.89501607717042,-0.2916821276562296,-0.46012458485743146,ansi_colony_test_1.png,1
262,448,0.6249999999999999,-17.729903536977492,-26.89887459807074,-0.2989109590656241,-0.6550316473413063,ansi_colony_test_1.png,1
581,276,0.59375,27.86350482315113,-2.3155948553054664,0.46975478079998534,-0.056388526855119116,ansi_colony_test_1.png,1
338,172,0.59375,-6.867524115755628,12.54871382636656,-0.11578056336096482,0.3055817320435057,ansi_colony_test_1.png,1
124,3,0.5833333333333333,-37.45369774919614,36.7032154340836,-0.6314372038977685,0.893783402753771,ansi_colony_test_1.png,1
14,456,0.5625,-53.17556270096463,-28.04228295819936,-0.896494355575565,-0.6828755134104313,ansi_colony_test_1.png,1
386,172,0.5416666666666666,-0.0070739549839228255,12.54871382636656,-0.00011926081065367657,0.3055817320435057,ansi_colony_test_1.png,1
81,216,0.5416666666666666,-43.59951768488746,6.2599678456591645,-0.735050454099089,0.15244046866331828,ansi_colony_test_1.png,1
488,193,1.0,14.57138263665595,9.54726688102894,0.2456610071087575,0.2324915836120526,n8_plate_1.png,2
449,233,0.9999999999999996,8.997266881028938,3.830225080385852,0.15168619878662967,0.09327225326642767,n8_plate_1.png,2
265,392,0.9999999999999996,-17.30112540192926,-18.89501607717042,-0.2916821276562296,-0.46012458485743146,n8_plate_1.png,2
580,276,0.9750000000000005,27.72057877813505,-2.3155948553054664,0.46734517033018713,-0.056388526855119116,n8_plate_1.png,2
7,69,0.96875,-54.17604501607717,27.270096463022508,-0.913361628864152,0.6640715076834898,n8_plate_1.png,2
261,448,0.9583333333333329,-17.872829581993567,-26.89887459807074,-0.3013205695354222,-0.6550316473413063,n8_plate_1.png,2
418,470,0.9375,4.566559485530546,-30.04324758842444,0.07698827422288707,-0.7316022790314,n8_plate_1.png,2
337,171,0.9375,-7.010450160771705,12.691639871382637,-0.11819017383076297,0.30906221530214634,n8_plate_1.png,2
81,216,0.9375,-43.59951768488746,6.2599678456591645,-0.735050454099089,0.15244046866331828,n8_plate_1.png,2
680,134,0.90625,42.01318327974277,17.979903536977492,0.708306217310002,0.43784009587184936,n8_plate_1.png,2
423,132,0.90625,5.281189710610932,18.265755627009646,0.08903632657187781,0.4448010623891306,n8_plate_1.png,2
380,274,0.90625,-0.8646302250803859,-2.029742765273312,-0.014576923629442568,-0.04942756033783787,n8_plate_1.png,2
505,200,0.875,17.00112540192926,8.546784565916399,0.286624385095326,0.20812820080156821,n8_plate_1.png,2
415,404,0.875,4.137781350482315,-20.610128617363348,0.06975944281349263,-0.501890383961119,n8_plate_1.png,2
103,188,0.875,-40.455144694533764,10.261897106109325,-0.6820390237635298,0.2498939999052557,n8_plate_1.png,2
76,243,0.875,-44.31414790996784,2.40096463022508,-0.7470985064480796,0.05846742068002144,n8_plate_1.png,2
546,160,0.84375,22.861093247588425,14.263826366559487,0.3854184143570501,0.3473475311471932,n8_plate_1.png,2
457,21,0.84375,10.140675241157556,34.13054662379421,0.17096308254501486,0.8311347040982396,n8_plate_1.png,2
350,201,0.84375,-5.152411575562701,8.403858520900322,-0.08686523772338703,0.2046477175429276,n8_plate_1.png,2
291,179,0.84375,-13.585048231511255,11.54823151125402,-0.2290322554414778,0.2812183492330213,n8_plate_1.png,2
255,24,0.833333333333333,-18.73038585209003,33.70176848874598,-0.3157782323542111,0.8206932543223178,n8_plate_1.png,2
277,25,0.8250000000000004,-15.586012861736336,33.5588424437299,-0.2627668020186519,0.8172127710636772,n8_plate_1.png,2
542,127,0.8125,22.289389067524116,18.98038585209003,0.3757799724778575,0.46220347868233363,n8_plate_1.png,2
390,23,0.8125,0.5646302250803859,33.84469453376206,0.009519181068538917,0.8241737375809585,n8_plate_1.png,2
386,173,0.8125,-0.0070739549839228255,12.405787781350483,-0.00011926081065367657,0.30210124878486505,n8_plate_1.png,2
318,71,0.8125,-9.72604501607717,26.984244372990354,-0.1639727727569278,0.6571105411662086,n8_plate_1.png,2
312,479,0.8125,-10.583601286173634,-31.329581993569136,-0.17843043557571667,-0.7629266283591657,n8_plate_1.png,2
225,312,0.8125,-23.018167202572346,-7.460932475884245,-0.3880665464481556,-0.18168592416618154,n8_plate_1.png,2
73,306,0.8125,-44.74292604501608,-6.603376205787781,-0.7543273378574742,-0.1608030246143378,n8_plate_1.png,2
579,308,0.8000000000000004,27.577652733118974,-6.889228295819936,0.46493555986038904,-0.16776399113161905,n8_plate_1.png,2
508,30,0.8000000000000004,17.429903536977495,32.84421221864952,0.29385321650472046,0.7998103547704741,n8_plate_1.png,2
460,137,0.7916666666666664,10.569453376205788,17.55112540192926,0.1781919139544093,0.4273986460959274,n8_plate_1.png,2
672,184,0.78125,40.86977491961415,10.833601286173634,0.6890293335516169,0.2638159329398182,n8_plate_1.png,2
541,36,0.78125,22.14646302250804,31.986655948553054,0.37337036200805934,0.7789274552186304,n8_plate_1.png,2
709,307,0.7750000000000004,46.158038585209006,-6.746302250803859,0.7781849209341484,-0.16428350787297843,n8_plate_1.png,2
653,231,0.7500000000000003,38.15418006430868,4.116077170418007,0.643246734625452,0.10023321978370892,n8_plate_1.png,2
419,201,0.7500000000000003,4.709485530546623,8.403858520900322,0.07939788469268522,0.2046477175429276,n8_plate_1.png,2
748,256,0.75,51.73215434083602,0.5429260450160772,0.8721597292562762,0.013221138317693346,n8_plate_1.png,2
554,43,0.75,24.004501607717042,30.986173633440515,0.40469529811543525,0.754564072408146,n8_plate_1.png,2
528,116,0.75,20.28842443729904,20.55257234726688,0.3420454259006835,0.5004887945273806,n8_plate_1.png,2
469,95,0.75,11.855787781350482,23.5540192926045,0.19987840818259264,0.5735789429588336,n8_plate_1.png,2
308,349,0.75,-11.155305466237943,-12.7491961414791,-0.18806887745490927,-0.3104638047358846,n8_plate_1.png,2
91,152,0.7499999999999998,-42.17025723472669,15.407234726688104,-0.7109543494011075,0.37519139721631817,n8_plate_1.png,2
620,173,0.7291666666666669,33.43762057877814,12.405787781350483,0.5637295891221131,0.30210124878486505,n8_plate_1.png,2
530,201,0.7250000000000003,20.574276527331193,8.403858520900322,0.34686464684027973,0.2046477175429276,n8_plate_1.png,2
152,212,0.7250000000000003,-33.45176848874598,6.831672025723473,-0.5639681107434203,0.16636240169788077,n8_plate_1.png,2
672,323,0.71875,40.86977491961415,-9.033118971061093,0.6890293335516169,-0.2199712400112284,n8_plate_1.png,2
663,194,0.71875,39.58344051446946,9.404340836012862,0.6673428393234335,0.22901110035341196,n8_plate_1.png,2
379,262,0.71875,-1.007556270096463,-0.31463022508038585,-0.016986534099240717,-0.007661761234150392,n8_plate_1.png,2
324,88,0.71875,-8.868488745980708,24.55450160771704,-0.14951510993813888,0.5979423257693179,n8_plate_1.png,2
41,141,0.71875,-49.31655948553055,16.97942122186495,-0.8314348728910149,0.4134767130613649,n8_plate_1.png,2
616,305,0.7000000000000003,32.86591639871383,-6.460450160771704,0.5540911472429205,-0.15732254135569718,n8_plate_1.png,2
504,297,0.7000000000000003,16.858199356913186,-5.317041800643087,0.2842147746255279,-0.1294786752865722,n8_plate_1.png,2
692,258,0.6875,43.728295819935695,0.2570739549839228,0.7372215429475798,0.006260171800412099,n8_plate_1.png,2
283,353,0.6875,-14.728456591639873,-13.320900321543409,-0.248309139199863,-0.3243857377704471,n8_plate_1.png,2
225,63,0.6875,-23.018167202572346,28.12765273311897,-0.3880665464481556,0.6849544072353335,n8_plate_1.png,2
23,46,0.6875,-51.88922829581993,30.55739549839228,-0.8748078613473815,0.7441226226322242,n8_plate_1.png,2
74,200,0.6666666666666665,-44.6,8.546784565916399,-0.751917727387676,0.20812820080156821,n8_plate_1.png,2
732,215,0.65625,49.44533762057878,6.402893890675242,0.8336059617395057,0.1559209519219589,n8_plate_1.png,2
473,283,0.65625,12.427491961414791,-3.3160771704180068,0.20951685006178525,-0.08075190966560349,n8_plate_1.png,2
445,25,0.65625,8.42556270096463,33.5588424437299,0.14204775690743707,0.8172127710636772,n8_plate_1.png,2
282,323,0.65625,-14.87138263665595,-9.033118971061093,-0.2507187496696611,-0.2199712400112284,n8_plate_1.png,2
14,455,0.65625,-53.17556270096463,-27.899356913183283,-0.896494355575565,-0.6793950301517907,n8_plate_1.png,2
"""
else:
    PLATE_CSV = """
x coord,y coord,quality,x mm,y mm,x%,y%,image_name,plate
117,189,1.0,-20.470000000000002,6.538695652173915,-0.45488888888888895,0.14530434782608698,2024.09.24_14.00.02.tif,1
235,138,0.9999999999999996,2.525748792270532,16.47753623188406,0.056127750939345154,0.36616747181964576,2024.09.24_14.00.02.tif,1
36,112,0.9999999999999996,-36.25521739130435,21.544396135265703,-0.805671497584541,0.4787643585614601,2024.09.24_14.00.02.tif,1
341,422,0.9999999999999996,23.182946859903385,-38.86816425120774,0.5151765968867419,-0.8637369833601719,2024.09.24_14.00.02.tif,1
339,65,0.9999999999999996,22.793188405797103,30.70371980676329,0.5065152979066023,0.6823048845947397,2024.09.24_14.00.02.tif,1
388,73,0.9166666666666663,32.34227053140097,29.144685990338168,0.7187171229200215,0.6476596886741816,2024.09.24_14.00.02.tif,1
61,272,0.9166666666666663,-31.38323671497585,-9.636280193236717,-0.6974052603327967,-0.2141395598497048,2024.09.24_14.00.02.tif,1
55,417,0.9166666666666663,-32.552512077294686,-37.89376811594204,-0.7233891572732153,-0.8420837359098231,2024.09.24_14.00.02.tif,1
408,124,0.9166666666666663,36.239855072463776,19.20584541062802,0.8053301127214172,0.42679656468062266,2024.09.24_14.00.02.tif,1
301,323,0.875,15.38777777777778,-19.575120772946864,0.34195061728395065,-0.4350026838432636,2024.09.24_14.00.02.tif,1
369,195,0.8749999999999997,28.639565217391308,5.369420289855073,0.6364347826086957,0.1193204508856683,2024.09.24_14.00.02.tif,1
338,32,0.8749999999999997,22.598309178743964,37.134734299516914,0.5021846484165325,0.8252163177670425,2024.09.24_14.00.02.tif,1
282,69,0.8749999999999997,11.685072463768117,29.92420289855073,0.25966827697262485,0.6649822866344606,2024.09.24_14.00.02.tif,1
67,257,0.8749999999999997,-30.21396135265701,-6.713091787439614,-0.671421363392378,-0.1491798174986581,2024.09.24_14.00.02.tif,1
34,27,0.8749999999999997,-36.64497584541063,38.109130434782614,-0.8143327965646806,0.8468695652173914,2024.09.24_14.00.02.tif,1
310,395,0.84375,17.14169082125604,-33.606425120772954,0.3809264626945787,-0.7468094471282879,2024.09.24_14.00.02.tif,1
104,57,0.833333333333333,-23.003429951690826,32.26275362318841,-0.5111873322597962,0.716950080515298,2024.09.24_14.00.02.tif,1
33,139,0.833333333333333,-36.83985507246377,16.28265700483092,-0.8186634460547505,0.361836822329576,2024.09.24_14.00.02.tif,1
35,345,0.833333333333333,-36.45009661835749,-23.862463768115948,-0.8100021470746109,-0.5302769726247989,2024.09.24_14.00.02.tif,1
48,354,0.833333333333333,-33.91666666666667,-25.616376811594208,-0.7537037037037038,-0.5692528180354268,2024.09.24_14.00.02.tif,1
112,41,0.833333333333333,-21.444396135265706,35.38082125603865,-0.4765421363392379,0.7862404723564145,2024.09.24_14.00.02.tif,1
307,167,0.833333333333333,16.55705314009662,10.826038647342997,0.36793451422436935,0.24057863660762216,2024.09.24_14.00.02.tif,1
337,164,0.833333333333333,22.403429951690825,11.410676328502417,0.49785399892646276,0.2535705850778315,2024.09.24_14.00.02.tif,1
393,203,0.833333333333333,33.31666666666668,3.810386473429952,0.7403703703703706,0.08467525496511004,2024.09.24_14.00.02.tif,1
317,346,0.8125,18.50584541062802,-24.057342995169087,0.4112410091250671,-0.5346076221148686,2024.09.24_14.00.02.tif,1
245,257,0.8125,4.474541062801933,-6.713091787439614,0.09943424584004296,-0.1491798174986581,2024.09.24_14.00.02.tif,1
76,240,0.7916666666666664,-28.46004830917875,-3.4001449275362323,-0.63244551798175,-0.07555877616747184,2024.09.24_14.00.02.tif,1
120,26,0.7916666666666664,-19.88536231884058,38.30400966183575,-0.4418969404186796,0.8512002147074611,2024.09.24_14.00.02.tif,1
166,328,0.7916666666666664,-10.920917874396137,-20.549516908212563,-0.2426870638754697,-0.45665593129361254,2024.09.24_14.00.02.tif,1
179,372,0.7916666666666664,-8.387487922705315,-29.12420289855073,-0.18638862050456256,-0.6472045088566829,2024.09.24_14.00.02.tif,1
200,71,0.7916666666666664,-4.295024154589372,29.534444444444446,-0.09544498121309716,0.656320987654321,2024.09.24_14.00.02.tif,1
407,49,0.7916666666666664,36.04497584541063,33.82178743961353,0.8009994632313474,0.7515952764358562,2024.09.24_14.00.02.tif,1
267,277,0.78125,8.761884057971015,-10.610676328502416,0.1947085346215781,-0.2357928073000537,2024.09.24_14.00.02.tif,1
126,307,0.78125,-18.716086956521742,-16.457053140096622,-0.41591304347826097,-0.36571229200214717,2024.09.24_14.00.02.tif,1
320,264,0.75,19.09048309178744,-8.077246376811594,0.42423295759527646,-0.17949436392914653,2024.09.24_14.00.02.tif,1
176,62,0.7499999999999998,-8.972125603864736,31.288357487922706,-0.1993805689747719,0.695296833064949,2024.09.24_14.00.02.tif,1
190,37,0.7499999999999998,-6.243816425120774,36.16033816425121,-0.13875147611379499,0.8035630703166935,2024.09.24_14.00.02.tif,1
276,304,0.7499999999999998,10.515797101449277,-15.8724154589372,0.23368438003220615,-0.35272034353193776,2024.09.24_14.00.02.tif,1
348,7,0.7499999999999998,24.547101449275363,42.00671497584541,0.5454911433172303,0.933482555018787,2024.09.24_14.00.02.tif,1
331,333,0.7499999999999998,21.234154589371983,-21.523913043478267,0.47187010198604407,-0.4783091787439615,2024.09.24_14.00.02.tif,1
418,180,0.7499999999999998,38.188647342995175,8.292608695652175,0.848636607622115,0.18428019323671502,2024.09.24_14.00.02.tif,1
395,412,0.7499999999999998,33.706425120772955,-36.91937198067633,0.7490316693505101,-0.820430488459474,2024.09.24_14.00.02.tif,1
411,340,0.71875,36.8244927536232,-22.888067632850245,0.8183220611916266,-0.5086237251744499,2024.09.24_14.00.02.tif,1
351,280,0.71875,25.131739130434784,-11.195314009661837,0.5584830917874396,-0.24878475577026304,2024.09.24_14.00.02.tif,1
187,211,0.71875,-6.828454106280194,2.2513526570048312,-0.1517434245840043,0.05003005904455181,2024.09.24_14.00.02.tif,1
81,367,0.71875,-27.48565217391305,-28.149806763285028,-0.6107922705314011,-0.625551261406334,2024.09.24_14.00.02.tif,1
261,140,0.7083333333333331,7.592608695652175,16.08777777777778,0.16872463768115945,0.35750617283950625,2024.09.24_14.00.02.tif,1
166,202,0.7083333333333331,-10.920917874396137,4.0052657004830925,-0.2426870638754697,0.08900590445517984,2024.09.24_14.00.02.tif,1
180,116,0.7083333333333331,-8.192608695652176,20.764879227053143,-0.18205797101449278,0.461441760601181,2024.09.24_14.00.02.tif,1
212,238,0.7083333333333331,-1.956473429951691,-3.010386473429952,-0.043477187332259803,-0.06689747718733227,2024.09.24_14.00.02.tif,1
331,172,0.7083333333333331,21.234154589371983,9.851642512077296,0.47187010198604407,0.21892538915727325,2024.09.24_14.00.02.tif,1
334,130,0.7083333333333331,21.818792270531404,18.03657004830918,0.4848620504562534,0.400812667740204,2024.09.24_14.00.02.tif,1
390,162,0.7083333333333331,32.732028985507256,11.800434782608697,0.7273784219001612,0.26223188405797104,2024.09.24_14.00.02.tif,1
407,72,0.7083333333333331,36.04497584541063,29.339565217391307,0.8009994632313474,0.6519903381642512,2024.09.24_14.00.02.tif,1
309,220,0.6875,16.9468115942029,0.49743961352657007,0.37659581320450886,0.01105421363392378,2024.09.24_14.00.02.tif,1
132,326,0.6875,-17.5468115942029,-20.159758454106285,-0.3899291465378422,-0.44799463231347303,2024.09.24_14.00.02.tif,1
259,270,0.6666666666666665,7.202850241545895,-9.246521739130436,0.16006333870101988,-0.20547826086956525,2024.09.24_14.00.02.tif,1
38,320,0.6666666666666665,-35.86545893719807,-18.990483091787443,-0.7970101986044016,-0.4220107353730543,2024.09.24_14.00.02.tif,1
45,77,0.6666666666666665,-34.501304347826085,28.365169082125608,-0.766695652173913,0.6303370907139024,2024.09.24_14.00.02.tif,1
50,199,0.6666666666666665,-33.526908212560386,4.589903381642513,-0.7450424047235641,0.10199785292538917,2024.09.24_14.00.02.tif,1
104,200,0.6666666666666665,-23.003429951690826,4.395024154589373,-0.5111873322597962,0.0976672034353194,2024.09.24_14.00.02.tif,1
161,78,0.6666666666666665,-11.895314009661838,28.170289855072465,-0.26434031132581864,0.6260064412238325,2024.09.24_14.00.02.tif,1
198,95,0.6666666666666665,-4.684782608695652,24.857342995169084,-0.10410628019323671,0.5523853998926463,2024.09.24_14.00.02.tif,1
208,212,0.6666666666666665,-2.7359903381642514,2.056473429951691,-0.06079978529253892,0.045699409554482026,2024.09.24_14.00.02.tif,1
433,90,0.6666666666666665,41.11183574879228,25.831739130434784,0.9135963499731617,0.5740386473429951,2024.09.24_14.00.02.tif,1
268,414,0.6666666666666665,8.956763285024156,-37.30913043478262,0.19903918411164792,-0.8290917874396138,2024.09.24_14.00.02.tif,1
283,59,0.6666666666666665,11.879951690821256,31.872995169082127,0.26399892646269457,0.7082887815351584,2024.09.24_14.00.02.tif,1
321,50,0.6666666666666665,19.28536231884058,33.62690821256039,0.42856360708534624,0.7472646269457864,2024.09.24_14.00.02.tif,1
321,104,0.6666666666666665,19.28536231884058,23.103429951690824,0.42856360708534624,0.5134095544820183,2024.09.24_14.00.02.tif,1
321,169,0.6666666666666665,19.28536231884058,10.436280193236717,0.42856360708534624,0.2319173376274826,2024.09.24_14.00.02.tif,1
329,406,0.6666666666666665,20.844396135265704,-35.750096618357496,0.46320880300590456,-0.7944465915190555,2024.09.24_14.00.02.tif,1
377,62,0.6666666666666665,30.19859903381643,31.288357487922706,0.6710799785292539,0.695296833064949,2024.09.24_14.00.02.tif,1
434,6,0.6666666666666665,41.306714975845416,42.201594202898555,0.9179269994632315,0.9378132045088567,2024.09.24_14.00.02.tif,1
388,370,0.6249999999999999,32.34227053140097,-28.73444444444445,0.7187171229200215,-0.6385432098765433,2024.09.24_14.00.02.tif,1
381,323,0.6249999999999999,30.97811594202899,-19.575120772946864,0.6884025764895331,-0.4350026838432636,2024.09.24_14.00.02.tif,1
"""

csv_data = PLATE_CSV.splitlines()[1:]  # Discard the blank first line.
colonies = list(csv.DictReader(csv_data))
num_plates = len(set([x for x in [c["plate"] for c in colonies]]))


def populate_deck(
    protocol: protocol_api.ProtocolContext,
    next_open_position=11,
):

    if TESTING:
        petri_dishes = [
            protocol.load_labware_from_definition(
                json.load(
                    open(
                        "labware/fisherbrandsquarepetridishwithadapter_1_reservoir_30000ul.json"
                    )
                ),
                next_open_position - i,
            )
            for i in range(num_plates)
        ]
        next_open_position = 4

        well_plates = [
            protocol.load_labware_from_definition(
                json.load(
                    open(
                        "labware/labcon_96_wellplate_2200ul.json"
                    )
                ),
                next_open_position + i,
            )
            for i in range(NUMBER_OF_WELL_PLATES)
        ]
        next_open_position = 1

    else:
        petri_dishes = [
            protocol.load_labware(
                "fisherbrandsquarepetridishwithadapter_1_reservoir_30000ul", next_open_position - i
            )
            for i in range(num_plates)
        ]
        next_open_position = 4

        well_plates = [
            protocol.load_labware(
                "labcon_96_wellplate_2200ul", next_open_position + i
            )
            for i in range(NUMBER_OF_WELL_PLATES)
        ]
        next_open_position = 1

    # Load in the tipracks. Fill the rest of the open positions.
    tip_racks = [
        protocol.load_labware("fisherinner_96_tiprack_10ul", next_open_position + i)
        for i in range(3)
    ]

    print(
        """
    Loaded labware:
    - {} 96-well plates: {}
    - {} petri dishes: {}
    - {} tipracks: {}
    """.format(
            len(well_plates),
            well_plates,
            len(petri_dishes),
            petri_dishes,
            len(tip_racks),
            tip_racks,
        )
    )

    return tip_racks, well_plates, petri_dishes


def pick_colony(
    protocol: protocol_api.ProtocolContext,
    pipette: protocol_api.InstrumentContext,
    petri_dish: protocol_api.labware.Labware,
    colony_location: tuple,
    position_pause: bool = False,
):
    """
    Given a plate location and a colony location, pick a colony.
    """
    # Get the colony location in the plate coordinate system.
    x, y = colony_location

    # TODO I'm guessing on all these parameters. Verify first in the lab.
    pipette.pick_up_tip()

    # Move to the colony location. Dip down into the petri dish. Pull back up.
    pipette.move_to(
        Location(petri_dish.wells()[0].from_center_cartesian(x=x, y=y, z=1), petri_dish)
    )  # TODO make sure z is correct. How do we set this as an offest?
    pipette.move_to(
        Location(
            petri_dish.wells()[0].from_center_cartesian(x=x, y=y, z=-1), petri_dish
        )
    )
    if position_pause:
        protocol.pause("Is the tip in the right spot?")
    pipette.move_to(
        Location(petri_dish.wells()[0].from_center_cartesian(x=x, y=y, z=1), petri_dish)
    )


def innoculate_colony(
    pipette: protocol_api.InstrumentContext,
    well_plates: List[protocol_api.labware.Labware],
):
    """
    With a picked colony on the tip of the pipette, innoculate the colony in the next availble well.
    """
    global colonies_picked
    plate = well_plates[colonies_picked // NUMBER_OF_WELLS]
    well = plate.wells()[
        colonies_picked % NUMBER_OF_WELLS
    ]  # this accesses the plate down the columns
    pipette.aspirate(10, well.bottom(5))
    pipette.dispense(10, well.bottom(5))
    # pipette.aspirate(10, well)
    # pipette.dispense(10, well)
    pipette.drop_tip()
    colonies_picked += 1


def run(protocol: protocol_api.ProtocolContext):

    tip_racks, well_plates, petri_dishes = populate_deck(protocol)

    # pipettes
    left_pipette = protocol.load_instrument(
        "p20_single_gen2", "left", tip_racks=tip_racks
    )
    right_pipette = protocol.load_instrument(
        "p20_multi_gen2", "right", tip_racks=tip_racks
    )

    for colony in colonies:
        if colonies_picked < (NUMBER_OF_WELLS * len(well_plates)):
            print(
                "Picking colony {} of {} from {} at x={} and y={}".format(
                    colonies_picked + 1,
                    len(well_plates * NUMBER_OF_WELLS),
                    colony["plate"],
                    colony["x%"],
                    colony["y%"],
                )
            )
            if colonies_picked < len(CONTROL_WELLS)+3:
                # pause to make sure that the tip is in the right spot for the first three colonies
                pick_colony(
                    protocol,
                    left_pipette,
                    petri_dishes[int(colony["plate"]) - 1],
                    (float(colony["x%"]), float(colony["y%"])),
                    position_pause=True,
                )
            else:
                pick_colony(
                    protocol,
                    left_pipette,
                    petri_dishes[int(colony["plate"]) - 1],
                    (float(colony["x%"]), float(colony["y%"])),
                )
            innoculate_colony(left_pipette, well_plates)
        else:
            print("Done with all plates.")
            break